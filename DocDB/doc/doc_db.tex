\documentclass[12pt]{article}

\input{memo_setup}
\input{abbrev}
\usepackage{ewv_environ}      %   %% Define some new environements                            

%\graphicspath{{sigmac_0999/}}

\begin{document}                                                 

\title{BTeV Document Database Design and Interface}

\author{
        Eric W. Vaandering, Vanderbilt University\\
        Lynn Garren, Fermilab\\
        \\
        {BTeV-doc-140}
       }
        

\date{27 November 2001 \\
      Revised: 19 December 2001}

\maketitle

\begin{abstract} 
In this memo, we describe the design and implementation of the BTeV document
database.
\end{abstract}

\section{Design considerations}

BTeV needs a document database that satisfies a number of requirements:
\begin{itemize}
\item{Each document can have multiple revisions and old revisions are still
available.}
\item{Each revision of each document can have multiple files. This accomodates
multiple file types (source and  presentable) and/or child files (especially
useful for trees of HTML  documents)}
\item{All documents are kept on the BTeV web server, not personal machines 
so we don't suffer from link rot}
\item{The ability to upload documents by browser upload or forcing the 
document database to download via http.}
\item{The ability of a single database to store talks from group meetings,
conference talks and proceedings, and publications \emph{and} to present these
special cases in ways that makes sense for those special case.}
\end{itemize}

There are several security issues we want to resolve too:
\begin{itemize}
\item{The ability to not only have public and private documents but also 
documents that are accessible to subgroups (like RTES) which don't know 
the BTeV password. We also want to have documents that are only 
accessible to sub-groups (like the executive council).}
\item{Users should only know that a document exists if they have 
privileges to view it.}
\item{The ability to easily move documents, or just certain versions of 
documents, from restricted to public and vice-versa.}
\end{itemize}

The document database system consists of three pieces which work together: a web-based
user interface, a relational database server to store information about the documents,
and a file system to store the documents. Additionally, the BTeV webserver serves
files from the file system to the users.

\section{Interface}

The document database is completely accessible via the web. HTML and HTML forms
provide the user interface and CGI scripts 
handle all accesses to the underlying database. 

While a search engine is not yet included in the product, one is planned.

These scripts are all written in Perl using the Perl::CGI package and 
the Perl::DBI database access modules. There is no reason 
additional access programs can't be written using PHP, C++, or any other 
language with an SQL interface. 

\section{Database}

The database design is essentialy finished, although small additions will
probably be needed for conference presentations and publications. (See \secref{extend}).

The document 
database is implemented as a number of different tables. Because each 
document can have multiple revisions and each revision can have 
multiple files (and authors and topics), there are three main tables 
Document, DocumentRevision, and DocumentFile. The hierarchy of these 
tables, their elements, and the auxiliary tables are shown in
\figref{db_structure}.

\begin{figure}
\begin{center}
\includegraphics[width=6in]{DocDB_model.eps}
\caption{The design of the document database. Indices are shown in read and the
symbols are described in the text.}
\figlabel{db_structure}
\end{center}
\end{figure}

The database design we are using is in the ``third normal form.'' For a longer
discussion of what this means and how a database is properly designed
see~\cite{YargerReeseKing:1999}. Essentially it boils down to three requirements:
\begin{enumerate}
\item{Each field of a database contains only one piece of information}
\item{Any field which has values in common across multiple entries should use a
unique identifier and another table}
\item{No two fields in a table should depend on each other}
\end{enumerate}
To take a simple example, the field containing the document type should contain
a unique identifier, not the name of the type because the name might have been
mis-spelled (rule 2). The institution of the person who wrote the document
something is not a property of the document, but of the person (rule 3).

The ``tree''-like
symbols indicate the one-to-many relationships within the database. For
instance, there can (and will) be many revisions of a  single document.  Rule 1
mandates that there can be no ``trees'' with branches on both ends. For example,
because each document revision can have multiple authors and an author can be associated with
multiple documents, an intermediate table RevisionAuthor is used. There is one entry
in this table for each author of each document revision.

Fields shown in red are indexed for fast look up. Other fields must be searched
on which is more time consuming. Each index takes up some  amount of disk
space, so the number of indices should be kept to a minimum. The ID
numbers in each entry indicate what other entries they are associated with. In
addition, each table has a timestamp which is not shown.

This database is implemented using MySQL; the server is running on
\url{fnsimu1.fnal.gov}.  The use of non-standard SQL features in the interface has
been kept to a minimum to ease porting to another another database if needed.

\section{File system and security}

All documents are placed into a single directory tree. There is no 
division based on security or topic since these are fluid designations 
(and each document can have multiple values for these settings). The 
file system is arranged only by document number. Each revision of each 
document is placed in its own directory, which means that most 
directories will only have a small number of files. However, the 
advantage of this scheme is two-fold. First, each of the files of a 
particular revision need not be renamed. Second, web access to each 
revision can be controlled with a potentially unique .htaccess file.

To avoid possible issues with large numbers of files in a single 
directory, the document directories are further divided into groups of 
100. For example, imagine that the 3rd revision of the 1029th document 
contains one file, text.ps. Then the full path looks like this:

\texttt{\$DOCROOT/0010/001029/003/text.ps}

As you can see, the file system is designed for up to 999,999 documents 
each of which can have up to 999 versions.

\section{Special Types of Documents}\seclabel{extend}

\subsection{Group meeting talks}

\subsection{Conference talks and proceedings}

\subsection{Journal publications}

\bibliographystyle{phaip}
\bibliography{physjabb,abbrev,other,btev}                                                                                      

\end{document}




