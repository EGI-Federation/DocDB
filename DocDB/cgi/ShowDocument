#! /usr/bin/perl
#
# Author Eric Vaandering (ewv@fnal.gov)
#

use CGI;
use DBI;

require "ResponseElements.pm";
require "MySQLAccess.pm";
require "DocDBGlobals.pm";
require "FSUtilities.pm";
require "Security.pm";

$query = new CGI;  # Global for subroutines

%params = $query -> Vars;

$DocumentID = $params{docid};

print $query->header;
print $query->start_html(-title=>"BTeV Document $DocumentID-v$Version");
$dbh   = DBI->connect('DBI:mysql:'.$db_name.':'.$db_host,$db_rwuser,$db_rwpass);

unless ($DocumentID) {
  print "You are must supply a document number!<p>\n";
  exit;
}  
  
&FetchDocument($DocumentID);

if (defined $params{version}) {
  $Version    = $params{version};
} else {   
  $Version = $Documents{$DocumentID}{NVER};
}

unless (&CanAccess($DocumentID,$Version)) {
  print "You are not authorized to view this document. Allowed for DEBUG
  purposes only.<p>\n";
#  exit;
}  
  

my $DocRevID   = &FetchDocRevision($DocumentID,$Version);

unless ($DocRevID) {
  print "This document does not exist.<p>\n";
  exit;
}
  

&PrintRevisionInfo($DocRevID);

&OtherVersionLinks($DocumentID,$Version);


print $query->end_html; 
