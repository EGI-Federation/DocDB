#! /usr/bin/perl
#
# Author Eric Vaandering (ewv@fnal.gov)
#

use CGI;
use DBI;

require "ResponseElements.pm";
require "MySQLAccess.pm";
require "DocDBGlobals.pm";
require "FSUtilities.pm";
require "Security.pm";

$query = new CGI;  # Global for subroutines
print $query->header;
print $query->start_html(-title=>"BTeV Document");
$dbh   = DBI->connect('DBI:mysql:'.$db_name.':'.$db_host,$db_rwuser,$db_rwpass);

%params = $query -> Vars;

$DocumentID = $params{docid};
$Version    = $params{version}; #FIXME allow leaving off version number

$DocumentID = 79;
$Version = 1;

unless (&CanAccess($DocumentID,$Version)) {
  print "You are not authorized to view this document.<p>\n";
#  exit;
}
&FetchDocument($DocumentID);
my $DocRevID   = &FetchDocRevision($DocumentID,$Version);
my $Files_ref  = &FetchDocFiles($DocRevID);

my $Authors_ref = &GetRevisionAuthors($DocRevID);
my $Topics_ref  = &GetRevisionTopics($DocRevID);

@AuthorIDs = @{$Authors_ref};
@TopicIDs = @{$Topics_ref};

&RequesterByID($Documents{$DocumentID}{REQUESTER});
&RequesterByID($DocRevisions{$DocRevID}{SUBMITTER});
&AuthorListByID(@AuthorIDs);
&TopicListByID(@TopicIDs);


print $query->end_html; 
