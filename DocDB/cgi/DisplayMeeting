#! /usr/bin/env perl
#
#        Name: DisplayMeeting
# Description: Displays talks for a meeting or just a session of a meeting
# 
#      Author: Eric Vaandering (ewv@fnal.gov)
#    Modified: 
#

use CGI;
use DBI;

require "Debug.pm"; #FIXME: Remove 

# cvs remove DisplaySession

require "DocDBGlobals.pm";
require "HTMLUtilities.pm";
require "ResponseElements.pm";
require "Sorts.pm";
require "Scripts.pm";

require "MeetingHTML.pm";
require "MeetingSQL.pm";

$query = new CGI;  # Global for subroutines

print $query -> header;
&DocDBHeader("Meeting Talks");
&TalkNotePopupScript;

%params = $query -> Vars;

my $SessionID          = $params{sessionid};
my $MeetingID          = $params{meetingid};

@ErrorStack = ();
@WarnStack  = ();

&HTMLPrintParams();

$dbh   = DBI -> connect('DBI:mysql:'.$db_name.':'.$db_host,$db_rwuser,$db_rwpass);

unless ($dbh) {
  push @ErrorStack,$Msg_NoConnect;
}         
&EndPage(@ErrorStack);

print "<h2>Put header information here</h2>\n";



if ($SessionID) {
  &FetchSessionByID($SessionID);
  &PrintSession($SessionID,1); # Display a single session
} elsif ($MeetingID) {
  # Fetch meeting, check ShowAllTalks
  # Loop over sessions and display them or link to them
  my @MeetingOrderIDs = &FetchMeetingOrdersByConferenceID($MeetingID);
  @MeetingOrderIDs = sort MeetingOrderIDByOrder @MeetingOrderIDs; 
  foreach $MeetingOrderID (@MeetingOrderIDs) {
    my $SessionID          = $MeetingOrders{$MeetingOrderID}{SessionID};
    my $SessionSeparatorID = $MeetingOrders{$MeetingOrderID}{SessionSeparatorID};
    if ($SessionID) {
      &FetchSessionByID($SessionID);
      &PrintSession($SessionID,0); # Display a single session
    } elsif ($SessionSeparatorID) {
      # Info on session separator?
    }
  }  
} elsif ($SessionSeparatorID) {
  # Info on session separator?
} else {
  #Complain that user didn't specify either
}  
  

&DocDBNavBar;
&DocDBFooter($DBWebMasterEmail,$DBWebMasterName);
 
exit;

  
  
