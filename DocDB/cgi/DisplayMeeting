#! /usr/bin/env perl
#
#        Name: DisplayMeeting
# Description: Displays talks for a meeting or just a session of a meeting
# 
#      Author: Eric Vaandering (ewv@fnal.gov)
#    Modified: 
#

use CGI;
use DBI;

#require "Debug.pm"; #FIXME: Remove 

# cvs remove DisplaySession

require "DocDBGlobals.pm";
require "HTMLUtilities.pm";
require "ResponseElements.pm";
require "Sorts.pm";
require "Scripts.pm";

require "MeetingHTML.pm";
require "MeetingSQL.pm";

$query = new CGI;  # Global for subroutines

print $query -> header;
&DocDBHeader("Meeting Talks");
&TalkNotePopupScript;

%params = $query -> Vars;

my $SessionID          = $params{sessionid};
my $SessionSeparatorID = $params{sessionseparatorid};
my $ConferenceID       = $params{conferenceid};

@ErrorStack = ();
@WarnStack  = ();

#&HTMLPrintParams();

$dbh   = DBI -> connect('DBI:mysql:'.$db_name.':'.$db_host,$db_rwuser,$db_rwpass);

unless ($dbh) {
  push @ErrorStack,$Msg_NoConnect;
}         
&EndPage(@ErrorStack);

if ($SessionID) {
  &FetchSessionByID($SessionID);
  &FetchConferenceByConferenceID($Sessions{$SessionID}{ConferenceID});

  &PrintMeetingInfo($Sessions{$SessionID}{ConferenceID});
  &PrintSession($SessionID,1); # Display a single session
  &PrintMeetingEpilogue($Sessions{$SessionID}{ConferenceID});
} elsif ($SessionSeparatorID) {
  # Info on session separator?
} elsif ($ConferenceID) {
  &FetchConferenceByConferenceID($ConferenceID);
  &PrintMeetingInfo($ConferenceID);
  
  # Check ShowAllTalks, see if we print session summaries or all talks
  # Loop over sessions and display them or link to them
  # Probably a Navbar of sorts if we display all of them
  
  my @MeetingOrderIDs = &FetchMeetingOrdersByConferenceID($ConferenceID);
  @MeetingOrderIDs = sort MeetingOrderIDByOrder @MeetingOrderIDs; 
  foreach $MeetingOrderID (@MeetingOrderIDs) {
    my $SessionID          = $MeetingOrders{$MeetingOrderID}{SessionID};
    my $SessionSeparatorID = $MeetingOrders{$MeetingOrderID}{SessionSeparatorID};
    if ($SessionID) {
      &FetchSessionByID($SessionID);
      &PrintSession($SessionID,0); # Display a single session
    } elsif ($SessionSeparatorID) {
      # Info on session separator?
    }
  }
  # If a topic-based meeting, display talks not associated with sessions  
  &PrintMeetingEpilogue($ConferenceID);
} else {
  #Complain that user didn't specify either
}  
  
&DocDBNavBar;
&DocDBFooter($DBWebMasterEmail,$DBWebMasterName);
 
exit;

  
  
