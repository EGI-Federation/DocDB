#! /usr/bin/perl
#
# Author Eric Vaandering (ewv@fnal.gov)
#

use CGI;                                                                                      
#use DBI;                                                                                      
require "DocDBGlobals.pm";
require "HTMLUtilities.pm";
require "SecuritySQL.pm";
require "Scripts.pm";

$query = new CGI;  # Global for subroutines
#$dbh   = DBI->connect('DBI:mysql:'.$db_name.':'.$db_host,$db_rouser,$db_ropass);

#&GetSecurityGroups;

print $query->header;
&BTeVHeader("BTeV Document Database","Document Database");

&HelpPopupScript;

# %params = $query -> Vars;  # No parameters (yet) 

print "<p><center><big><font color=red><b>Testing only! All data may be
lost!</b></font></big></center>\n";

print "<p><b><a
href=\"http://vuhepv.phy.vanderbilt.edu/BTeV/DocDB/DocDB_Help.shtml\">Help on
using</a> the database:</b>\n";
print "<p><b>Find the information you want in the database:</b>\n";
print "<ul>\n";
print "<li>Search documents (still coming)"; 
print "<p>\n";
print "<li>"; 
print $query -> startform('POST',$ShowDocument);
print $query -> submit (-value => "Show");
print " document # "; 
print $query -> textfield(-name => "docid", -size => 6, -maxlength => 6);
print $query -> endform;

print "<li>"; 
print $query -> startform('POST',$ListDocuments);
print $query -> submit (-value => "List all");
print " documents"; 
print $query -> endform;

print "</ul>\n";

print "<p><b>Short cuts for putting information into the database: ";
print "(<a "; &HelpLink("modifytypes"); 
print "Help!</a>)</b>\n";
print "<ul>\n";

print "<li>"; 
print $query -> startform('POST',$DocumentAddForm);
print $query -> submit (-value => "Reserve");
print " a document number\n"; 
print "(if you don't yet have a draft of your document).\n";
print $query -> hidden(-name => 'mode',    -default => 'reserve');
print $query -> endform;

print "<li>"; 
print $query -> startform('POST',$DocumentAddForm);
print $query -> submit (-value => "Create a new");
print " document from a file on your <b><a "; 
&HelpLink("uploadmethod"); 
print "local computer</a></b> \n"; 
print "(no need to reserve the document).\n";
print $query -> hidden(-name => 'mode',    -default => 'add');
print $query -> hidden(-name => 'upload',    -default => 'file');
print $query -> endform;

print "<li>"; 
print $query -> startform('POST',$DocumentAddForm);
print $query -> submit (-value => "Create a new");
print " document from a file on the <b><a "; 
&HelpLink("uploadmethod"); 
print "web</a></b> \n"; 
print "(no need to reserve the document).\n";
print $query -> hidden(-name => 'mode',    -default => 'add');
print $query -> hidden(-name => 'upload',    -default => 'http');
print $query -> endform;

print "<li>"; 
print $query -> startform('POST',$DocumentAddForm);
print $query -> submit (-value => "Update");
print " document # "; 
print $query -> textfield(-name => "docid", -size => 6, -maxlength => 6);
print $query -> hidden(-name => 'mode',    -default => 'update');
print $query -> endform;

print "<li>"; 
print $query -> startform('POST',$DocumentAddForm);
print $query -> submit (-value => "Update Database");
print " for document # "; 
print $query -> textfield(-name => "docid", -size => 6, -maxlength => 6);
print $query -> hidden(-name => 'mode',    -default => 'updatedb');
print $query -> endform;
print "</ul>\n";

print "<p>\n";

print "<b>If the above choices don't meet your needs,use this form to produce a
customized<br> document creation or update form. Click on any term for
help.</b><p>\n";

$modes{reserve}  = "Reserve document #";
$modes{add}      = "New document";
$modes{update}   = "Update existing document";
$modes{updatedb} = "Update DB information";  # See note in ProcessDocumentAdd

@modes = ("add","reserve","update","updatedb");

$uploads{http}   = "HTTP submission";
$uploads{file}   = "Local file upload";
@uploads = ("file","http");

$archives{archive}    = "Archive (.tar/.zip) upload";
$archives{single}   = "Single file";
$archives{multi}   = "Multiple files";
@archives = ("single","multi","archive");

$topicmodes{multi}  = "Multiple Topic Boxes";
$topicmodes{single} = "Single Topic List";
@topicmodes = ("multi","single");

$authormodes{field}  = "Text field";
$authormodes{list} = "Selectable list";
@authormodes = ("list","field");


print $query -> start_multipart_form('POST',$DocumentAddForm);
print "<table cellpadding=5 border=5>\n";
print "<tr><td align=right>\n";
print "<a "; &HelpLink("modifytypes"); 
print "<b>Type of modification:</b></a>\n";
print "<td>\n";
 print "<table cellpadding=3><tr><td>\n";
 print $query -> radio_group(-name => "mode", -labels => \%modes, -values => \@modes, -columns => 2);
 print "<tr><td align=right valign=bottom>\n";
 print "<b>Update Doc #:</b>\n";
 print $query -> textfield(-name => "docid", -size => 6, -maxlength => 6);
 print "&nbsp;&nbsp;&nbsp;\n";
 print "</table>\n";

print "<tr><td align=right>\n";
print "<a "; &HelpLink("uploadtype"); 
print "<b>Upload type:</b></a>\n";
print "<td>\n";
print "<table cellpadding=3><tr><td>\n";
print $query -> radio_group(-name => "archive", -values => \@archives, -labels
                            => \%archives, -columns => 1);
print "<td>\n";
print $query -> textfield(-name => "numfile", -size => 2, -maxlength => 2);
print "<b># of files</b>\n";
print "</table>\n";

print "<tr><td align=right>\n";
print "<a "; &HelpLink("uploadmethod"); 
print "<b>Upload method:</b></a>\n";
print "<td>\n";
print $query -> radio_group(-name => "upload", -values => \@uploads, -labels => \%uploads);

print "<tr><td align=right>\n";
print "<a "; &HelpLink("topicoption"); 
print "<b>Topic Selection:</b></a>\n";
print "<td>\n";
print $query -> radio_group(-name => "topicmode", -values => \@topicmodes, -labels => \%topicmodes);
#print "<tr><td align=right>\n";
#print "<b>Author Selection:</b>\n";
#print "<td>\n";
#print $query -> radio_group(-name => "authormode", -values => \@authormodes, -labels => \%authormodes);
print "<tr><td align=right>\n";
print "<a "; &HelpLink("dateoverride"); 
print "<b>Override submit date:</b></a>\n";
print "<td>\n";
print $query -> checkbox(-name => "overdate", -label => '(Check for Yes)');
print "<tr><td align=center colspan=2>\n";
print $query -> submit (-value => "Give me my customized form");
print "</table>\n";
print $query -> endform;

print "<p><b>Administrative functions:</b><ul>\n";
if ($remote_user eq $Administrator) {
  print "<li>Add a <a href=\"$TopicAddForm\">topic</a>\n";
}
print "<li>Add an <a href=\"$AuthorAddForm\">author</a>\n";
print "<li>Eric's <a href=\"http://www.hep.vanderbilt.edu/~vondo/btev-private/DocDB-ToDo.html\">To do list</a> for the database \n";
print "</ul>\n";

&BTeVFooter($DBWebMasterEmail,$DBWebMasterName);

